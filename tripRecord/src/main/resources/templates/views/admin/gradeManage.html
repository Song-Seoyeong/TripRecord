<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>등급 관리</title>
<link href="css/admin/gradeManage.css" rel="stylesheet" type="text/css">
<link href="css/admin/adminAll.css" rel="stylesheet" type="text/css"/>
<!-- 파비콘 -->
<link rel="icon" href="image/icon_case.ico" type="image/x-icon"/>
<link rel="shortcut icon" href="image/icon_case.ico" type="image/x-icon"/>
<!-- 끝 -->
</head>
<body>
	<div th:replace="~{common/adminHeader :: header}"></div>
	<div class="container-box" style="margin: 0; padding: 0px; width: 100%;">
		<div class="board-list">
			<div class="board-list-ul-content">
				<ul class="board-list-ul">
					<li><a href="dashBoard.ad">대시보드</a></li>
					<li><a href="memberManage.ad">회원 관리</a></li>
					<li><a href="questManage.ad">문의사항 관리</a></li>
					<li class="select-board"><a href="gradeManage.ad">등급 관리</a></li>
					<li><a href="noticeManage.ad">공지사항 관리</a></li>
					<li><a href="pointManage.ad">포인트 관리</a></li>
					<li><a href="boardManage.ad">게시판 관리</a></li>
					<li><a href="hashTagManage.ad">해시태그 관리</a></li>
					<li><a href="contentImgManage.ad">사진 관리</a></li>
					<li><a href="planManage.ad">일정 관리</a></li>
					<li><a href="otherManage.ad">기타 관리</a></li>
				</ul>
			</div>
			<div class="out-adminPage">
				<a class="out-text" href="/home"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-door-open" viewBox="0 0 16 16">
  <path d="M8.5 10c-.276 0-.5-.448-.5-1s.224-1 .5-1 .5.448.5 1-.224 1-.5 1"/>
  <path d="M10.828.122A.5.5 0 0 1 11 .5V1h.5A1.5 1.5 0 0 1 13 2.5V15h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V1.5a.5.5 0 0 1 .43-.495l7-1a.5.5 0 0 1 .398.117M11.5 2H11v13h1V2.5a.5.5 0 0 0-.5-.5M4 1.934V15h6V1.077z"/>
</svg>&nbsp; 관리자 페이지 나가기</a>
			</div>
		</div>
		<div class="board-main">
			<div class="title-board display-4">
				<h1 style="display: inline; font-size: 2.5rem !important;">등급 관리</h1>
			</div>
			<div class="container-top display-flex">
				<div class="request-container">
					<div class="title-div">
						<span class="title-text">등급 요청</span>
					</div>
					<div class="content-request">
						<ul class="request-list">
							<li th:each="r : ${rList}">
								<div class="request-list-detail display-inline-block">
									<ul class="request-list-ul">
										<li style="width: 5%;">[[${r.memberNo}]]</li>
										<li style="width: 10%;">[[${r.memberName}]]</li>
										<li style="width: 10%;">
											<th:block th:if="${r.grade == 'PLANNER'}">
												플래너
											</th:block>
											<th:block th:if="${r.grade == 'ADMIN'}">
												관리자
											</th:block>
											<th:block th:if="${r.grade == 'PLANNER_CANCEL'}">
												플래너 취소
											</th:block>
											<th:block th:if="${r.grade == 'ADMIN_CANCEL'}">
												관리자 취소
											</th:block>
										</li>
										<li style="width: 10%;">
											<th:block th:if="${r.localName == 'null'}"></th:block>
											<th:block th:unless="${r.localName == 'null'}">
												[[${r.localName}]]
											</th:block>
										</li>
										<li class="overflow-ell" style="width: 50%;">
											<th:block th:if="${r.plaReqContent == 'null'}"></th:block>
											<th:block th:unless="${r.plaReqContent == 'null'}">
												<abbr th:title="${r.plaReqContent}" class="abbr">[[${r.plaReqContent}]]</abbr>
											</th:block>
										</li>
										<li style="width: 10%;">[[${#strings.replace(r.requestDate, '-', '.')}]]</li>
										<li style="width: 5%;">
											<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
										  		<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
										  		<path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
											</svg>
										</li>
										<li style="width: 5%;">
											<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
											  	<path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
											  	<path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
											</svg>
										</li>
									</ul>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="container-bottom display-flex">
				<div class="plan-container">
					<div class="title-div">
						<span class="title-text">플래너</span>
					</div>
					<div class="plan-table rounded-2 list-table">
						<table class="table-user table">
							<thead>
								<tr style="border-bottom: 1px solid #96caf0; border-bottom-width: medium;">
									<th style="width: 5%;">번호</th>
									<th style="width: 10%;">이름</th>
									<th style="width: 13%;">아이디</th>
									<th style="width: 7%;">활동 지역</th>
									<th style="width: 12%;">정산 금액</th>
									<th style="width: 7%;">경고 횟수</th>
									<th style="width: 6%;">취소</th>
								</tr>
							</thead>
						  	<tbody>
						  		<tr class="tr-user" th:each="p : ${pList}">
						      		<td>[[${p.memberNo}]]</td>
						      		<td>[[${p.memberName}]]</td>
						      		<td>[[${p.memberId}]]</td>
									<td>[[${p.localName}]]</td>
									<td th:each="c : ${cList}" th:if="${!cList.isEmpty && c.plannerNo == p.memberNo}">
										<span th:text="${c.expectedMoney == 0 ? '0' : #numbers.formatInteger(c.expectedMoney, 3, 'COMMA')}"><</span>
									</td>
									<td th:if="${cList.isEmpty}">
										0
									</td>
									<td>
										<th:block th:if="${p.warningCount >= 3}"> 
											<span style="color: red;" th:text="${p.warningCount}"></span>
										</th:block>
										<th:block th:unless="${p.warningCount >= 3}"> 
											[[${p.warningCount}]]
										</th:block>
									</td>
									<td><div class="cancel-border" style="width: 70%; margin: 0 auto;">취소</div></td>
						  		</tr>
						  	</tbody>
						</table>
					</div>
				</div>
				<div class="manage-container">
					<div class="title-div">
						<span class="title-text">관리자</span>
					</div>
					<div class="manage-table rounded-2 list-table">
						<table class="table-user table">
							<thead>
								<tr style="border-bottom: 1px solid #96caf0; border-bottom-width: medium;">
									<th>번호</th>
									<th>이름</th>
									<th>아이디</th>
									<th>취소</th>
								</tr>
							</thead>
						  	<tbody>
						  		<tr class="tr-user" th:each="a : ${aList}">
						      		<td>[[${a.memberNo}]]</td>
						      		<td>[[${a.memberName}]]</td>
						      		<td>[[${a.memberId}]]</td>
									<td><div class="cancel-border" style="width: 70%; margin: 0 auto;">취소</div></td>
						  		</tr>
						  	</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="modal fade" tabindex="-1" role="dialog" id="modal-check">
		<div class="modal-dialog modal-dialog-centered" role="document">
    		<div class="modal-content rounded-3 shadow">
      			<div class="modal-body p-4 text-center">
        			<h3 class="mb-0">회원 등급을 변경하였습니다.</h3>
      			</div>
      			<div class="modal-footer flex-nowrap p-0">
        			<button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0 border-end" id="ok">
        				<strong>확인</strong>
        			</button>
      			</div>
    		</div>
  		</div>
	</div>
	
	<div class="modal fade" tabindex="-1" role="dialog" id="modal-cancel">
		<div class="modal-dialog modal-dialog-centered" role="document">
    		<div class="modal-content rounded-3 shadow">
      			<div class="modal-body p-4 text-center">
        			<h3 class="mb-0">일반 회원으로 전환하시겠습니까?</h3>
        			<p class="mb-0">계정 비밀번호를 입력 후 '확인' 클릭 시<br> 선택한 회원의 등급이 일반으로 변경됩니다.</p>
        			<div style="height:10px;"></div>
        			<input type="password" id="modalInput">
        			<div style="width: 100%; height: 15px;" id="modalHide"></div>
      			</div>
      			<div class="modal-footer flex-nowrap p-0">
        			<button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0 border-end" id="cancel-ok">
        				<strong>확인</strong>
        			</button>
        			<button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0" data-bs-dismiss="modal" id="cancel-no">취소</button>
      			</div>
    		</div>
  		</div>
	</div>
	
	<div class="modal fade" tabindex="-1" role="dialog" id="modal-x-cancel">
		<div class="modal-dialog modal-dialog-centered" role="document">
    		<div class="modal-content rounded-3 shadow">
      			<div class="modal-body p-4 text-center">
        			<h3 class="mb-0">요청을 거절하시겠습니까?</h3>
        			<p class="mb-0">계정 비밀번호를 입력 후 '확인' 클릭 시 요청이 거절됩니다.</p>
        			<div style="height:10px;"></div>
        			<input type="password" id="xModalInput">
        			<div style="width: 100%; height: 15px;" id="xModalHide"></div>
      			</div>
      			<div class="modal-footer flex-nowrap p-0">
        			<button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0 border-end" id="x-cancel-ok">
        				<strong>확인</strong>
        			</button>
        			<button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0" data-bs-dismiss="modal" id="cancel-no">취소</button>
      			</div>
    		</div>
  		</div>
	</div>
	
	<script th:inline="javascript">
		window.onload = () => {
			
			/* 등급 요청 */
			const checkIcons = document.getElementsByClassName('bi-check-circle');
			const xIcons = document.getElementsByClassName('bi-x-circle');
			
			for(const check of checkIcons){
				check.addEventListener('click', function(){
					
					const ul = check.parentElement.parentElement;
					const grade = ul.children[2].innerText;
					
					if(grade.includes('취소')){
						$.ajax({
							type: 'POST',
							url: 'gradeDownSuccess.ad',
							data: {
								mNo: ul.children[0].innerText
							},
							success: data => {
								$('#modal-check').modal('show');
							}
						});
					} else{
						$.ajax({
							type: 'POST',
							url: 'gradeSuccess.ad',
							data: {
								mNo: ul.children[0].innerText
							},
							success: data => {
								$('#modal-check').modal('show');
							}
						});
					}
				});
			}
			
			let xMNo;
			for(const x of xIcons){
				x.addEventListener('click', function(){
					const ul = x.parentElement.parentElement;
					xMNo = ul.children[0].innerText;
					
					$('#modal-x-cancel').modal('show');
					
					
					
				});
			}
			
			document.getElementById("x-cancel-ok").addEventListener('click', function(){
				const xModalId = document.getElementById('xModalInput').value;
				if(xModalId != ''){
					$.ajax({
						type: 'POST',
						url: 'matchPwd.ad',
						data: {
							pwd: xModalId
						},
						success: data => {
							if(data == 'success'){
								location.href="gradeFail.ad?mNo=" + xMNo;
							} else{
								document.getElementById('xModalHide').style.color = 'red';
								document.getElementById('xModalHide').style.paddingLeft = '5px';
								document.getElementById('xModalHide').style.fontSize = '15px';
								document.getElementById('xModalHide').innerText = '비밀번호가 일치하지 않습니다.';
							}
						}
					});
				} else {
					document.getElementById('modalHide').style.color = 'red';
					document.getElementById('modalHide').style.paddingLeft = '5px';
					document.getElementById('modalHide').style.fontSize = '15px';
					document.getElementById('modalHide').innerText = '비밀번호를 입력하세요.';
				}
			});
			
			
			document.getElementById('ok').addEventListener('click', function(){
				location.href='gradeManage.ad';
			});
			
			
			/* 등급 취소 */
			const divs = document.getElementsByClassName('cancel-border');
			let myId;
			for(const div of divs){
				div.addEventListener('click', function(){
					tr = this.parentElement.parentElement;
					
					mNo = tr.children[0].innerText;
					$('#modal-cancel').modal('show');
				});
			}
			
			document.getElementById('modalInput').addEventListener('focus', function(){
				document.getElementById('modalHide').innerText = '';
			});
			
			document.getElementById('cancel-ok').addEventListener('click', function(){
				const modalId = document.getElementById('modalInput').value;
				if(modalId != ''){
					$.ajax({
						type: 'POST',
						url: 'matchPwd.ad',
						data: {
							pwd: modalId
						},
						success: data => {
							if(data == 'success'){
								location.href="updateGrade.ad?mNo=" + mNo;
							} else{
								document.getElementById('modalHide').style.color = 'red';
								document.getElementById('modalHide').style.paddingLeft = '5px';
								document.getElementById('modalHide').style.fontSize = '15px';
								document.getElementById('modalHide').innerText = '비밀번호가 일치하지 않습니다.';
							}
						}
					});
				} else{
					document.getElementById('modalHide').style.color = 'red';
					document.getElementById('modalHide').style.paddingLeft = '5px';
					document.getElementById('modalHide').style.fontSize = '15px';
					document.getElementById('modalHide').innerText = '비밀번호를 입력하세요.';
				}
			});
			
			document.getElementById('cancel-no').addEventListener('click', function(){
				document.getElementById('modalInput').value = '';
			});
			
			
			
			
			const listLi = document.getElementsByClassName('board-list-ul')[0].children;
			const current = document.getElementsByClassName('select-board')[0];
			
			for(const li of listLi){
				const a = li.children[0];
				li.addEventListener('mouseenter', function() {
					current.style.transitionDuration = '300ms';
					li.style.transitionDuration = '300ms';
					if(li.className != 'select-board'){
						current.className = '';
						this.className = 'select-board';
						
					}
				});
				
				li.addEventListener('mouseleave', function(){
					li.style.transitionDuration = '300ms';
					if(li.className == 'select-board' && li != current){
						current.className = 'select-board';
						this.className = '';
					}
				});
				
			}
			
		} 
	</script>
</body>
</html>