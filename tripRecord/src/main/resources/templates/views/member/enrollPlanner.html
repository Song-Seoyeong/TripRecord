<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>플래너 회원가입</title>
<link type="text/css" href='css/member/enrollPlanner.css' rel="stylesheet">
<style>

</style>
</head>
<body>
	<div th:replace="~{ common/logoBar :: logoBar }"></div>
	<div th:replace="~{ common/mainCategoryBar :: mainCategoryBar }"></div>
	
	<!-- 완전 큰 로그인 글자 -->
	<div id="bigTitle" class='text-center'>플래너 회원가입</div>
	
	<!-- 회원가입 폼 -->
	<form id="enrollPlanner" method="POST">
		<div id='enrollDiv'>
			<div class="inputDiv row">
				<div class='col-3'></div>
				<div class='col-2'>
					<label class="loginText">아이디</label>
				</div>
				<div  class='col-4'>
					<input type="text" name='memId' placeholder="아이디를 입력하세요">
					<div id='idText' class="alert-div"></div>
				</div>
				<div class='col-3'></div>
			</div>
			<div class="row pwdInputDiv">
				<div class='col-3'></div>
				<div class='col-2'>
					<label class="loginText">비밀번호</label>
				</div>
				<div  class='col-4'>
					<input type="password" name='memPwd' placeholder="비밀번호를 입력하세요">
				</div>
				<div class='col-3'></div>
			</div>
			<div class="row pwdInputDiv">
				<div class='col-5'></div>
				<div class='col-7'>
					<div id='pwdText' class="alert-div"></div>
				</div>
			</div>
			<div class="inputDiv row">
				<div class='col-3'></div>
				<div class='col-2'>
					<label class="loginText">비밀번호 확인</label>
				</div>
				<div  class='col-4'>
					<input type="password" id='pwdconfirm' placeholder="비밀번호를 한번 더 입력하세요">
					<div id='pwdConfirmText' class="alert-div"></div>
				</div>
				<div class='col-3'></div>
			</div>
			<div class="inputDiv row">
				<div class='col-3'></div>
				<div class='col-2'>
					<label class="loginText">이름</label>
				</div>
				<div  class='col-4'>
					<input type="text" name='memName' placeholder="이름를 입력하세요">
					<div class="alert-div"></div>
				</div>
				<div class='col-3'></div>
			</div>
			<div class="inputDiv row">
				<div class='col-3'></div>
				<div class='col-2'>
					<label class="loginText">닉네임</label>
				</div>
				<div  class='col-4'>
					<input type="text" name='memNickname' placeholder="닉네임를 입력하세요">
					<div id='nicknameText' class="alert-div"></div>
				</div>
				<div class='col-3'></div>
			</div>
			<div class="inputDiv row">
				<div class='col-3'></div>
				<div class='col-2'>
					<label class="loginText">전화번호</label>
				</div>
				<div  class='col-4'>
					<input type="text" name='memPhone' placeholder="전화번호를 입력하세요" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');" />
					<div id='phoneText' class="alert-div"></div>
				</div>
				<div class='col-3'></div>
			</div>
			<div class="inputDiv row">
				<div class='col-3'></div>
				<div class='col-2'>
					<label class="loginText">이메일</label>
				</div>
				<div class='col-6' style="display:flex">
					<input type="text" name='memEmail' id='memEmail' placeholder="이메일">
					<div id='atSign' class='text-center'>@</div>
					<input id="domain" type="text" aria-lavel="Text input with dropdown button" value="naver.com">
					<select id="selectDomain" class="form-select">
						<option class="dropdown-item">naver.com</option>
						<option class="dropdown-item">google.com</option>
						<option class="dropdown-item">yahoo.com</option>
						<option class="dropdown-item">직접 입력</option>
					</select>
				</div>
				<div class="col-1"></div>
			</div>
			<div class="inputDiv row">
				<div class="col-3"></div>
				<div class="col-2"></div>
				<div class="col-4">
					<div class="alert-div"></div>
				</div>
			</div>
			<div class="inputDiv row" style="margin-bottom:15px;">
				<div class='col-3'></div>
				<div class='col-2'>
					<label class="loginText">활동지역</label>
				</div>
				<div  class='col-4'>
					<select name='local' id='local' class="form-select">
						<option selected>활동 지역 선택</option>
						<option>서울</option>
						<option>부산</option>
						<option>강원도</option>
					</select>
				</div>
				<div class='col-3'></div>
			</div>
			<div class="inputDiv row" style="margin-bottom:15px;">
				<div class='col-3'></div>
				<div class='col-2'>
					<label class="loginText">프로필 소개글</label>
				</div>
				<div  class='col-4'>
					<textArea id="short-intro" class='textArea' placeholder='플래너 리스트에 보여질 간단한 소개글을 작성해주세요'></textArea>
				</div>
				<div class='col-3'></div>
			</div>
			<div class="inputDiv row">
				<div class='col-3'></div>
				<div class='col-2'>
					<label class="loginText">신청글</label>
				</div>
				<div  class='col-4'>
					<textArea id="to-admin" class='textArea' placeholder='관리자에게 보여질(?) 신청글을 작성해주세요'></textArea>
				</div>
				<div class='col-3'></div>
			</div>
			<div class='d-grid gap-2 d-md-flex justify-content-md-center align-items-center'>
				<button type="button" class="btn btn-primary" id='enrollButton'>회원가입</button>
				<a id='enrollPlaner' href="enrollView.me">일반 회원가입</a>
			</div>
	
		</div>
	</form>
	<!-- 회원가입 폼 -->
	
	<!-- 모달하고싶었는데 아직 모르겠음
	<div class="modal fade" tabindex="-1" role="dialog" id="modalIntro">
		<div class="modal-dialog" role="document">
    		<div class="modal-content rounded-3 shadow">
      			<div class="modal-body p-4 text-center">
        			<h3 class="mb-0">정말로 빈칸으로 신청하시겠습니까?</h3>
        			<p class="mb-0">플래너로 가입되면 이후 다시 수정할 수 있습니다.</p>
      			</div>
      			<div class="modal-footer flex-nowrap p-0">
        			<button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0 border-end" id="mIntro">
        				<strong>네</strong>
        			</button>
        			<button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0" data-bs-dismiss="modal">아니오</button>
      			</div>
    		</div>
  		</div>
	</div>
	
	<div class="modal fade" tabindex="-1" role="dialog" id="modalApply">
		<div class="modal-dialog" role="document">
    		<div class="modal-content rounded-3 shadow">
      			<div class="modal-body p-4 text-center">
        			<h3 class="mb-0">정말로 빈칸으로 신청하시겠습니까?</h3>
        			<p class="mb-0">관리자가 승인을 거부할 수도 있습니다.</p>
      			</div>
      			<div class="modal-footer flex-nowrap p-0">
        			<button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0 border-end" id="mApply">
        				<strong>네</strong>
        			</button>
        			<button type="button" class="btn btn-lg btn-link fs-6 text-decoration-none col-6 m-0 rounded-0" data-bs-dismiss="modal">아니오</button>
      			</div>
    		</div>
  		</div>
	</div> -->
	
	
	
	
	
	
	<div th:replace="~{ common/footer.html :: footer }"></div>
	
	
	
	<script>
		window.onload=()=>{
			const selectDomain = document.getElementById("selectDomain");
			const domain = document.getElementById("domain");
			selectDomain.addEventListener('change', function(){
				if(this.value != "직접 입력"){
					domain.value = this.value;
				} else{
					domain.value = "";
				}
			});
			
			const regPwd = /^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*?_]).{8,16}$/;
			const enrollbtn = document.getElementById("enrollButton");
			const inputId = document.getElementsByName("memId")[0];
			const inputPwd = document.getElementsByName("memPwd")[0];
			const pwdconfirm = document.getElementById("pwdconfirm");
			const inputName = document.getElementsByName("memName")[0];
			const inputNickname = document.getElementsByName("memNickname")[0];
			const inputPhone = document.getElementsByName("memPhone")[0];
			const firstEmail = document.getElementById("memEmail");
			const alertDivs = document.getElementsByClassName("alert-div");
			const local = document.getElementById("local");
			const intro = document.getElementById("short-intro");
			const apply = document.getElementById("to-admin");
			
			
			enrollbtn.onclick = e =>{
				if(inputId.value.trim() == ''){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					alertDivs[0].innerText = "아이디를 입력해주세요";
					alertDivs[0].style.color = 'red';
					inputId.focus();
					e.preventDefault();
				} else if(inputPwd.value.trim() == ''){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					alertDivs[1].innerText = "비밀번호를 입력해주세요";
					alertDivs[1].style.color = 'red';
					inputPwd.focus();
					e.preventDefault();
				} else if(!regPwd.test(pwd.value)){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					alertDivs[1].innerText = '영어 대소문자/숫자/특수문자를 모두 포함하여 8~15자 이내로 생성해주세요';
					alertDivs[1].style.color = 'red';
					inputPwd.focus();
					e.preventDefault();
				} else if(!(pwdconfirm.value === inputPwd.value && (pwdconfirm.value.trim() != '' || inputPwd.value.trim() != ''))){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					alertDivs[2].style.color = 'red';
					alertDivs[2].innerText = "비밀번호가 일치하지 않습니다";
					pwdconfirm.focus();
					e.preventDefault();
				} else if(inputName.value.trim() == ''){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					alertDivs[3].innerText = "이름을 입력해주세요";
					alertDivs[3].style.color = 'red';
					inputName.focus();
					e.preventDefault();
				} else if(inputNickname.value.trim() == ''){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					alertDivs[4].innerText = "닉네임을 입력해주세요";
					alertDivs[4].style.color = 'red';
					inputNickname.focus();
					e.preventDefault();
				} else if(inputPhone.value.trim() == ''){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					alertDivs[5].innerText = "전화번호를 입력해주세요";
					alertDivs[5].style.color = 'red';
					inputPhone.focus();
					e.preventDefault();
				} else if(firstEmail.value.trim() == '' || domain.value.trim() == ''){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					alertDivs[6].innerText = "이메일을 입력해주세요";
					alertDivs[6].style.color = 'red';
					if(firstEmail.value.trim() == ''){
						firstEmail.focus();
						e.preventDefault();
					}else{
						domain.focus();
						e.preventDefault();
					}
				} else if(local.value == '활동 지역 선택'){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					local.focus();
					e.preventDefault();
				} else if(intro.value.trim() == ''){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					// 여기에 모달 하고싶었는데
					alert("소개글을 빈칸으로 제출을 원하시면 '없음' 을 적어주세요");
					e.preventDefault();
				} else if(apply.value.trim() == ''){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					// 여기에 모달 하고싶었는데
					alert("신청글을 빈칸으로 제출을 원하시면 '없음' 을 적어주세요");
					e.preventDefault();
				} else if(pwdconfirm.value === inputPwd.value && (pwdconfirm.value.trim() != '' || inputPwd.value.trim() != '')){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					alertDivs[2].style.color = 'green';
					alertDivs[2].innerText = "비밀번호가 일치합니다";
				} else if(!pwdconfirm.value === inputPwd.value || !(pwdconfirm.value.trim() != '' || inputPwd.value.trim() != '')){
					for(const a of alertDivs){
						a.innerText = "";
						a.style.color = 'white';
					}
					alertDivs[2].style.color = 'red';
					alertDivs[2].innerText = "비밀번호가 일치하지 않습니다";
					pwdconfirm.focus();
					e.preventDefault();
				}
			}
			
			
			
			pwdconfirm.addEventListener('focusout',()=>{
				if(pwdconfirm.value === inputPwd.value && (pwdconfirm.value.trim() != '' || inputPwd.value.trim() != '')){
					alertDivs[2].style.color = 'green';
					alertDivs[2].innerText = "비밀번호가 일치합니다";
					return true;
				} else{
					alertDivs[2].style.color = 'red';
					alertDivs[2].innerText = "비밀번호가 일치하지 않습니다";
					return false;
				}
			});
			
			
		}
		
		
		// window.onload 밖
		
		
		// 비밀번호 체크
//		const regPwd = /^[A-Za-z0-9@.]{8,15}$/;
		const regPwd = /^(?=.*[a-zA-Z])(?=.*[0-9])(?=.*[!@#$%^&*?_]).{8,16}$/;
		const pwd = document.getElementsByName("memPwd")[0];
		const alertDivs = document.getElementsByClassName("alert-div");
		
		pwd.addEventListener('focusout',()=>{
			if(!regPwd.test(pwd.value)){
				alertDivs[1].innerText = '영어 대소문자/숫자/특수문자를 모두 포함하여 8~15자 이내로 생성해주세요';
				alertDivs[1].style.color = 'red';
				
				return false;
			} else {
				alertDivs[1].innerText = '사용 가능한 비밀번호입니다';
				alertDivs[1].style.color = 'green';
				return true;
			}
		});
		
		
		
		// 아이디 체크 (넣을예정)
		const regId = /^[A-Za-z0-9]{4,10}$/;
		const inputId = document.getElementsByName("memId")[0];
		const alertDiv = document.getElementsByClassName("alert-div")[0];
		
		inputId.addEventListener('focusout', checkId);
		
		function checkId(){
			let id = inputId.value;
			if(id.trim() != ''){
				$.ajax({
					url: 'checkId.me',
					data: {id:id},
					success: (data) => {
						if(data == 0 && regId.test(id)){
							alertDiv.innerText = '사용 가능한 아이디입니다';
							alertDiv.style.color = 'green'
							return true;
						} else {
							alertDiv.innerText = '사용 불가한 아이디입니다';
							alertDiv.style.color = 'red';
							return false;
						}
					},
					error: data => console.log(data)
				});
			}
		}
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
		
	</script>
	
	
	
	
	
	
	
	
	
	
	
	
</body>
</html>
